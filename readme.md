# ESP32-S3 ProjectG - æŒ‰éˆ•æ§åˆ¶ MQTT éŸ³è¨Šç³»çµ±

## ğŸ“– å°ˆæ¡ˆæ¦‚è¿°

ESP32-S3 ProjectG æ˜¯ä¸€å€‹åŸºæ–¼ ESP32-S3 N16R8 é–‹ç™¼æ¿çš„æ™ºèƒ½éŸ³è¨Šè™•ç†ç³»çµ±ï¼Œæ”¯æ´æŒ‰éˆ•æ§åˆ¶éŒ„éŸ³ã€MQTT éŸ³è¨Šå‚³è¼¸ã€å³æ™‚ç‰¹å¾µæå–å’Œå¤šåª’é«”æ’­æ”¾åŠŸèƒ½ã€‚æœ¬å°ˆæ¡ˆå¾åŸæœ¬çš„ã€Œé–‹æ©Ÿè‡ªå‹•éŒ„éŸ³ã€æ¨¡å¼æ”¹é€²ç‚ºã€ŒæŒ‰éˆ•æ§åˆ¶éŒ„éŸ³ã€æ¨¡å¼ï¼Œæä¾›æ›´ç²¾ç¢ºçš„éŸ³è¨ŠéŒ„è£½æ§åˆ¶ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **ğŸ¯ æŒ‰éˆ•æ§åˆ¶éŒ„éŸ³**ï¼šæŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹éŒ„éŸ³ï¼Œå†æŒ‰ä¸€æ¬¡åœæ­¢ä¸¦è™•ç†éŸ³è¨Š
- **ğŸ“¡ MQTT éŸ³è¨Šå‚³è¼¸**ï¼šå³æ™‚éŸ³è¨Šæ•¸æ“šé€é MQTT å”è­°å‚³é€åˆ°é ç«¯æœå‹™å™¨
- **ğŸµ éŸ³è¨Šç‰¹å¾µæå–**ï¼šæ”¯æ´ MFCCã€æ¢…çˆ¾é »è­œã€é »è­œé‡å¿ƒç­‰ç‰¹å¾µè¨ˆç®—
- **ğŸ’¡ æ™ºèƒ½ç‹€æ…‹æŒ‡ç¤º**ï¼šLED å’Œ OLED é¡¯ç¤ºå™¨åæ˜ ç³»çµ±ç•¶å‰ç‹€æ…‹
- **ğŸ”§ ç¡¬é«”è‡ªé©æ‡‰**ï¼šè‡ªå‹•æª¢æ¸¬ç¡¬é«”å¯ç”¨æ€§ä¸¦é™ç´šé‹è¡Œ
- **âš¡ å®‰å…¨è³‡æºç®¡ç†**ï¼šI2S è³‡æºå®‰å…¨æ¸…ç†ï¼Œé¿å…ç³»çµ±å´©æ½°

### ğŸ® æ“ä½œæ–¹å¼

1. **é–‹å§‹éŒ„éŸ³**ï¼šæŒ‰ä¸‹éº¥å…‹é¢¨æ§åˆ¶æŒ‰éˆ•
   - LED è®Šç‚ºç´…è‰²å‘¼å¸ç‡ˆ
   - OLED é¡¯ç¤º "Btn: REC" + éŒ„éŸ³æ™‚é–“

2. **åœæ­¢éŒ„éŸ³**ï¼šå†æ¬¡æŒ‰ä¸‹éº¥å…‹é¢¨æ§åˆ¶æŒ‰éˆ•
   - LED è®Šç‚ºè—è‰²è™•ç†ç‹€æ…‹
   - è‡ªå‹•è™•ç†éŸ³è¨Šæ•¸æ“šä¸¦è¼¸å‡º

3. **ç³»çµ±å°±ç·’**ï¼šè™•ç†å®Œæˆå¾Œ
   - LED è®Šç‚ºç¶ è‰²å¾…æ©Ÿ
   - OLED é¡¯ç¤º "Btn: READY"

### å°ˆæ¡ˆæ­·ç¨‹

æœ¬å°ˆæ¡ˆç¶“æ­·äº†å¾è‡ªå‹•éŒ„éŸ³åˆ°æŒ‰éˆ•æ§åˆ¶çš„é‡å¤§é‡æ§‹ï¼š

1. **åˆå§‹ç‰ˆæœ¬**ï¼šé–‹æ©Ÿè‡ªå‹•é–‹å§‹ MQTT éŸ³è¨Šå‚³è¼¸
2. **æŒ‰éˆ•æ§åˆ¶ç‰ˆæœ¬**ï¼šæ”¹ç‚ºç”¨æˆ¶å¯æ§çš„éŒ„éŸ³æ¨¡å¼
3. **ç©©å®šç‰ˆæœ¬**ï¼šè§£æ±º I2S è³‡æºç®¡ç†å•é¡Œï¼Œå¯¦ç¾ç©©å®šé‹è¡Œ

## ğŸ”Œ ç¡¬é«”é…ç½®

### é–‹ç™¼æ¿è¦æ ¼

- **ä¸»æ§èŠ¯ç‰‡**ï¼šESP32-S3 WROOM-1 N16R8
- **Flash è¨˜æ†¶é«”**ï¼š16 MB
- **PSRAM**ï¼š8 MB
- **WiFi**ï¼š2.4 GHz 802.11 b/g/n
- **è—ç‰™**ï¼šBluetooth 5.0 LE

æ¨è–¦è³¼è²·ï¼š[ESP32-S3 N16R8 é–‹ç™¼æ¿](https://www.taiwansensor.com.tw/product/esp32-s3-devkitc-1-%E9%96%8B%E7%99%BC%E6%9D%BF-%E6%A8%82%E9%91%AB-wroom-1-n16r8-%E5%B7%B2%E7%84%8A%E6%8E%A5%E9%87%9D%E8%85%B3/?srsltid=AfmBOopRlAkA0Pqg56TTQj8SVzKgSCUIz-w4B6i-VNpxVR8ESW0LrRBx)

### å®Œæ•´æ¥ç·šåœ–

```text
ESP32-S3 é–‹ç™¼æ¿æ¥ç·šåœ–
â”œâ”€â”€ I2S éº¥å…‹é¢¨ (INMP441)
â”‚   â”œâ”€â”€ SCK  â†’ GPIO20 (I2S æ™‚é˜)
â”‚   â”œâ”€â”€ WS   â†’ GPIO18 (å­—é¸æ“‡)
â”‚   â”œâ”€â”€ SD   â†’ GPIO21 (æ•¸æ“šè¼¸å…¥)
â”‚   â”œâ”€â”€ VDD  â†’ 3.3V
â”‚   â”œâ”€â”€ GND  â†’ GND
â”‚   â””â”€â”€ L/R  â†’ GND (å·¦è²é“)
â”‚
â”œâ”€â”€ OLED é¡¯ç¤ºå™¨ (SH1106/SSD1306)
â”‚   â”œâ”€â”€ SDA  â†’ GPIO8  (I2C æ•¸æ“š)
â”‚   â”œâ”€â”€ SCL  â†’ GPIO9  (I2C æ™‚é˜)
â”‚   â”œâ”€â”€ VCC  â†’ 3.3V
â”‚   â””â”€â”€ GND  â†’ GND
â”‚
â”œâ”€â”€ æ§åˆ¶æŒ‰éˆ•
â”‚   â”œâ”€â”€ éŸ³é‡å¢åŠ     â†’ GPIO1  â†’ GND
â”‚   â”œâ”€â”€ éŸ³é‡æ¸›å°‘    â†’ GPIO2  â†’ GND
â”‚   â””â”€â”€ éº¥å…‹é¢¨æ§åˆ¶  â†’ GPIO42 â†’ GND
â”‚
â””â”€â”€ LED æŒ‡ç¤ºç‡ˆ
    â”œâ”€â”€ RGB LED (å…±é™°æ¥µ)
    â”‚   â”œâ”€â”€ ç´…è‰² â†’ GPIO35
    â”‚   â”œâ”€â”€ ç¶ è‰² â†’ GPIO36
    â”‚   â””â”€â”€ è—è‰² â†’ GPIO37
    â”‚
    â””â”€â”€ NeoPixel/WS2812B
        â”œâ”€â”€ æ•¸æ“š â†’ GPIO48
        â”œâ”€â”€ VCC  â†’ 5V
        â””â”€â”€ GND  â†’ GND
```

### å¼•è…³é…ç½®è¡¨

| åŠŸèƒ½ | GPIO | é¡å‹ | èªªæ˜ |
|------|------|------|------|
| OLED SDA | GPIO8 | I2C | I2C æ•¸æ“šç·š |
| OLED SCL | GPIO9 | I2C | I2C æ™‚é˜ç·š |
| éŸ³é‡å¢åŠ  | GPIO1 | æŒ‰éˆ• | å…§éƒ¨ä¸Šæ‹‰ï¼ŒæŒ‰ä¸‹æ¥åœ° |
| éŸ³é‡æ¸›å°‘ | GPIO2 | æŒ‰éˆ• | å…§éƒ¨ä¸Šæ‹‰ï¼ŒæŒ‰ä¸‹æ¥åœ° |
| éº¥å…‹é¢¨æ§åˆ¶ | GPIO42 | æŒ‰éˆ• | å…§éƒ¨ä¸Šæ‹‰ï¼ŒéŒ„éŸ³æ§åˆ¶ |
| éº¥å…‹é¢¨ WS | GPIO18 | I2S | I2S å­—é¸æ“‡ä¿¡è™Ÿ |
| éº¥å…‹é¢¨ SD | GPIO21 | I2S | I2S æ•¸æ“šè¼¸å…¥ |
| éº¥å…‹é¢¨ SCK | GPIO20 | I2S | I2S æ™‚é˜ä¿¡è™Ÿ |
| LED æ§åˆ¶ | GPIO48 | NeoPixel | ç‹€æ…‹æŒ‡ç¤ºç‡ˆ |
| ç´…è‰² LED | GPIO35 | è¼¸å‡º | RGB LED ç´…è‰²åˆ†é‡ |
| ç¶ è‰² LED | GPIO36 | è¼¸å‡º | RGB LED ç¶ è‰²åˆ†é‡ |
| è—è‰² LED | GPIO37 | è¼¸å‡º | RGB LED è—è‰²åˆ†é‡ |

### æŒ‰éˆ•æ§åˆ¶

| åŠŸèƒ½ | ESP32-S3 å¼•è…³ | æ¥ç·šæ–¹å¼ |
|------|---------------|----------|
| éŸ³é‡å¢åŠ  | GPIO1 | æŒ‰éˆ• -> GND |
| éŸ³é‡æ¸›å°‘ | GPIO2 | æŒ‰éˆ• -> GND |
| éº¥å…‹é¢¨æ§åˆ¶ | GPIO42 | æŒ‰éˆ• -> GND |

## ğŸ—ï¸ è»Ÿé«”æ¶æ§‹

### ç³»çµ±æ¶æ§‹åœ–

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESP32-S3 ProjectG                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»å‹™ç®¡ç† (FreeRTOS)                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚æŒ‰éˆ•æ§åˆ¶ä»»å‹™  â”‚ â”‚éº¥å…‹é¢¨ä»»å‹™    â”‚ â”‚OLEDé¡¯ç¤ºä»»å‹™ â”‚           â”‚
â”‚ â”‚buttonControlâ”‚ â”‚microphone   â”‚ â”‚oledUpdate   â”‚           â”‚
â”‚ â”‚Task         â”‚ â”‚Task         â”‚ â”‚Task         â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚ â”‚LEDæ§åˆ¶ä»»å‹™   â”‚ â”‚éŸ³è¨Šæ§åˆ¶ä»»å‹™  â”‚                           â”‚
â”‚ â”‚ledControl   â”‚ â”‚audioControl â”‚                           â”‚
â”‚ â”‚Task         â”‚ â”‚Task         â”‚                           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡¬é«”æŠ½è±¡å±¤                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚I2S é©…å‹•     â”‚ â”‚I2C é©…å‹•     â”‚ â”‚GPIO é©…å‹•    â”‚           â”‚
â”‚ â”‚(éº¥å…‹é¢¨)     â”‚ â”‚(OLED)       â”‚ â”‚(æŒ‰éˆ•/LED)   â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€šè¨Šå”è­°                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚ â”‚WiFi ç®¡ç†    â”‚ â”‚MQTT å®¢æˆ¶ç«¯  â”‚                           â”‚
â”‚ â”‚(è‡ªå‹•é‡é€£)   â”‚ â”‚(éŸ³è¨Šå‚³è¼¸)   â”‚                           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

#### 1. æŒ‰éˆ•æ§åˆ¶ç³»çµ±

- **æª”æ¡ˆ**ï¼š`src/main.cpp` (buttonControlTask å‡½æ•¸)
- **åŠŸèƒ½**ï¼šç›£æ§æŒ‰éˆ•è¼¸å…¥ï¼Œè™•ç†é˜²æŠ–å‹•ï¼Œç®¡ç†éŒ„éŸ³ç‹€æ…‹
- **ç‹€æ…‹æ©Ÿ**ï¼šå¾…æ©Ÿ â†’ éŒ„éŸ³ä¸­ â†’ è™•ç†ä¸­ â†’ å¾…æ©Ÿ

#### 2. I2S éŸ³è¨Šè™•ç†

- **æª”æ¡ˆ**ï¼š`src/main.cpp` (microphoneTask å‡½æ•¸)
- **åŠŸèƒ½**ï¼š16kHz 16-bit éŸ³è¨Šæ¡é›†ï¼Œé›»å¹³ç›£æ§ï¼Œè³‡æ–™è¼¸å‡º
- **é—œéµé…ç½®**ï¼š
  - æ¡æ¨£ç‡ï¼š16kHz
  - ä½æ·±åº¦ï¼š16-bit
  - è²é“ï¼šå–®è²é“ (å·¦è²é“)
  - DMA ç·©è¡å€ï¼š4 Ã— 512 æ¨£æœ¬

#### 3. MQTT éŸ³è¨Šå‚³è¼¸

- **æª”æ¡ˆ**ï¼š`src/AudioMqttManager.cpp` (ç›®å‰åœç”¨)
- **åŠŸèƒ½**ï¼šéŸ³è¨Šæ•¸æ“šå°åŒ…åŒ–ï¼ŒMQTT ç™¼å¸ƒï¼Œç‰¹å¾µæå–
- **ä¸»é¡Œçµæ§‹**ï¼š
  - `esp32/audio/raw` - åŸå§‹éŸ³è¨Šæ•¸æ“š
  - `esp32/audio/mfcc` - MFCC ç‰¹å¾µä¿‚æ•¸
  - `esp32/audio/features` - çµ±è¨ˆç‰¹å¾µ

#### 4. ç‹€æ…‹é¡¯ç¤ºç³»çµ±

- **OLED é¡¯ç¤º**ï¼š`src/OledDisplay.cpp`
- **LED æ§åˆ¶**ï¼š`src/LedController.cpp`
- **ç‹€æ…‹æ˜ å°„**ï¼š
  - å¾…æ©Ÿï¼šç¶ è‰²å¸¸äº®ï¼ŒOLED é¡¯ç¤º "Btn: READY"
  - éŒ„éŸ³ï¼šç´…è‰²å‘¼å¸ç‡ˆï¼ŒOLED é¡¯ç¤º "Btn: REC" + æ™‚é–“
  - è™•ç†ï¼šè—è‰²å¸¸äº®ï¼ŒOLED é¡¯ç¤º "Btn: PROC"

### å·¥ä½œæµç¨‹

#### æŒ‰éˆ•éŒ„éŸ³å®Œæ•´æµç¨‹

```text
ç”¨æˆ¶æ“ä½œ                ç³»çµ±ç‹€æ…‹               ç¡¬é«”æŒ‡ç¤º
   â”‚                      â”‚                     â”‚
 æŒ‰ä¸‹æŒ‰éˆ•  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  é–‹å§‹éŒ„éŸ³              LED ç´…è‰²å‘¼å¸ç‡ˆ
   â”‚                      â”‚                   OLED "Btn: REC"
   â”‚                   I2S åˆå§‹åŒ–              
   â”‚                   éŸ³è¨Šæ•¸æ“šæ”¶é›†             ä¸²å£è¼¸å‡ºéŸ³è¨Šæ•¸æ“š
   â”‚                      â”‚                     â”‚
 å†æŒ‰æŒ‰éˆ•  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  åœæ­¢éŒ„éŸ³              LED è—è‰²å¸¸äº®
   â”‚                      â”‚                   OLED "Btn: PROC"
   â”‚                   I2S è³‡æºæ¸…ç†            
   â”‚                   éŸ³è¨Šç‰¹å¾µæå–             
   â”‚                   MQTT æ•¸æ“šå‚³é€           
   â”‚                      â”‚                     â”‚
   â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  å›åˆ°å¾…æ©Ÿ              LED ç¶ è‰²å¸¸äº®
   â”‚                      â”‚                   OLED "Btn: READY"
```

### I2S é…ç½®

```cpp
// éº¥å…‹é¢¨ I2S é…ç½® (I2S_NUM_1)
const i2s_config_t i2s_config = {
    .mode = i2s_mode_t(I2S_MODE_MASTER | I2S_MODE_RX),
    .sample_rate = 16000,
    .bits_per_sample = i2s_bits_per_sample_t(16),
    .channel_format = I2S_CHANNEL_FMT_ONLY_LEFT,
    .communication_format = i2s_comm_format_t(I2S_COMM_FORMAT_STAND_I2S),
    .intr_alloc_flags = ESP_INTR_FLAG_LEVEL1,
    .dma_buf_count = 4,
    .dma_buf_len = 512,
    .use_apll = false
};
```

## âš™ï¸ è»Ÿé«”å®‰è£èˆ‡é…ç½®

### 1. é–‹ç™¼ç’°å¢ƒè¨­ç½®

```bash
# å®‰è£ PlatformIO
pip install platformio

# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd "d:\workspace\study\ProjectG"

# ç·¨è­¯å°ˆæ¡ˆ
pio run

# ä¸Šå‚³ç¨‹å¼
pio run --target upload

# ç›£æ§ä¸²åˆ—è¼¸å‡º
pio device monitor
```

### 2. WiFi è¨­ç½®

åœ¨ `src/main.cpp` ä¸­ä¿®æ”¹ WiFi è¨­å®šï¼š

```cpp
// WiFi è¨­ç½®
const char *ssid = "æ‚¨çš„WiFiåç¨±";
const char *password = "æ‚¨çš„WiFiå¯†ç¢¼";
```

### 3. MQTT æœå‹™å™¨è¨­ç½®

ç³»çµ±å·²é è¨­ä½¿ç”¨å…è²»çš„ Eclipse Mosquitto å…¬å…±æœå‹™å™¨ï¼š

```cpp
// MQTT è¨­ç½®
const char *mqttServer = "test.mosquitto.org";
const int mqttPort = 1883;
const char *mqttUser = nullptr;     // ç„¡éœ€èªè­‰
const char *mqttPassword = nullptr; // ç„¡éœ€èªè­‰
```

## ğŸ“¡ MQTT å”è­°æ¶æ§‹

### MQTT ä¸»é¡Œçµæ§‹

| ä¸»é¡Œ | æ–¹å‘ | å…§å®¹ | æ ¼å¼ |
|------|------|------|------|
| `esp32/audio/raw` | ç™¼å¸ƒ | åŸå§‹éŸ³è¨Šæ•¸æ“š | JSON |
| `esp32/audio/mfcc` | ç™¼å¸ƒ | MFCC ä¿‚æ•¸ (13å€‹) | JSON |
| `esp32/audio/mel` | ç™¼å¸ƒ | æ¢…çˆ¾èƒ½é‡ (26å€‹) | JSON |
| `esp32/audio/features` | ç™¼å¸ƒ | éŸ³è¨Šç‰¹å¾µ | JSON |
| `esp32/audio/status` | ç™¼å¸ƒ | ç³»çµ±ç‹€æ…‹ | JSON |
| `esp32/audio/control` | è¨‚é–± | æ§åˆ¶å‘½ä»¤ | JSON |

### æ§åˆ¶å‘½ä»¤

ç™¼é€åˆ° `esp32/audio/control` ä¸»é¡Œï¼š

```json
// é–‹å§‹éŸ³è¨Šç™¼å¸ƒ
{"command": "startPublishing", "timestamp": 1234567890}

// åœæ­¢éŸ³è¨Šç™¼å¸ƒ
{"command": "stopPublishing", "timestamp": 1234567890}

// å•Ÿç”¨ç‰¹å¾µæå–
{"command": "enableFeatures", "timestamp": 1234567890}

// åœç”¨ç‰¹å¾µæå–
{"command": "disableFeatures", "timestamp": 1234567890}
```

## ğŸ”¬ éŸ³è¨Šç‰¹å¾µæå–

### ç‰¹å¾µé¡å‹

1. **MFCC ä¿‚æ•¸ (13å€‹)**ï¼šèªéŸ³è­˜åˆ¥å¸¸ç”¨ç‰¹å¾µ
2. **æ¢…çˆ¾æ¿¾æ³¢å™¨çµ„èƒ½é‡ (26å€‹)**ï¼šæ¢…çˆ¾åˆ»åº¦çš„é »è­œèƒ½é‡
3. **é »è­œé‡å¿ƒ**ï¼šé »è­œçš„"é‡å¿ƒ"ä½ç½®
4. **é »è­œå¸¶å¯¬**ï¼šé »è­œèƒ½é‡çš„åˆ†æ•£ç¨‹åº¦
5. **éé›¶ç‡**ï¼šéŸ³è¨Šä¿¡è™Ÿçš„éé›¶é »ç‡
6. **RMS èƒ½é‡**ï¼šéŸ³è¨Šä¿¡è™Ÿçš„å‡æ–¹æ ¹èƒ½é‡

### è™•ç†åƒæ•¸

- **æ¡æ¨£ç‡**ï¼š16 kHz
- **ä½æ·±åº¦**ï¼š16 ä½
- **FFT å¤§å°**ï¼š512
- **è¦–çª—å¤§å°**ï¼š400 æ¨£æœ¬ (25ms)
- **è·³èºå¤§å°**ï¼š160 æ¨£æœ¬ (10ms)

## ğŸš€ å…è²» MQTT æœå‹™å™¨

### æ¨è–¦æœå‹™å™¨

#### 1. Eclipse Mosquitto (é è¨­ï¼Œæ¨è–¦)

```cpp
const char *mqttServer = "test.mosquitto.org";
const int mqttPort = 1883;
```

- âœ… æœ€ç©©å®šï¼šEclipse åŸºé‡‘æœƒå®˜æ–¹ç¶­è­·
- âœ… ç„¡éœ€è¨»å†Šï¼šç›´æ¥ä½¿ç”¨
- âœ… å…¨çƒå¯ç”¨ï¼š24/7 å¯ç”¨æ€§

#### 2. HiveMQ å…¬å…±æœå‹™å™¨

```cpp
const char *mqttServer = "broker.hivemq.com";
const int mqttPort = 1883;
```

#### 3. EMQX å…¬å…±æœå‹™å™¨

```cpp
const char *mqttServer = "broker.emqx.io";
const int mqttPort = 1883;
```

## ğŸ§ª æ¸¬è©¦èˆ‡é©—è­‰

### Python æ¸¬è©¦è…³æœ¬

```bash
# ç°¡å–® MQTT æ¸¬è©¦
python simple_mqtt_test.py

# éŸ³è¨Šå®¢æˆ¶ç«¯æ¸¬è©¦
python test_mqtt_audio_client.py

# æœå‹™å™¨é€£æ¥æ¸¬è©¦
python test_mqtt_servers.py
```

### MQTT å®¢æˆ¶ç«¯å·¥å…·æ¸¬è©¦

```bash
# è¨‚é–±æ‰€æœ‰éŸ³è¨Šä¸»é¡Œ
mosquitto_sub -h test.mosquitto.org -t "esp32/audio/#" -v

# ç™¼é€æ§åˆ¶å‘½ä»¤
mosquitto_pub -h test.mosquitto.org -t "esp32/audio/control" -m '{"command":"startPublishing"}'
```

## ğŸ“ å°ˆæ¡ˆæª”æ¡ˆçµæ§‹

```text
ProjectG/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp                 # ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ AudioMqttManager.cpp     # MQTT éŸ³è¨Šç®¡ç†
â”‚   â”œâ”€â”€ AudioFeatureExtractor.cpp # éŸ³è¨Šç‰¹å¾µæå–
â”‚   â”œâ”€â”€ LedController.cpp        # LED æ§åˆ¶
â”‚   â”œâ”€â”€ OledDisplay.cpp          # OLED é¡¯ç¤º
â”‚   â””â”€â”€ AudioPlayer.cpp          # éŸ³è¨Šæ’­æ”¾
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ AudioMqttManager.h
â”‚   â”œâ”€â”€ AudioFeatureExtractor.h
â”‚   â”œâ”€â”€ LedController.h
â”‚   â”œâ”€â”€ OledDisplay.h
â”‚   â””â”€â”€ AudioPlayer.h
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ simple_mqtt_test.py      # ç°¡å–® MQTT æ¸¬è©¦
â”‚   â”œâ”€â”€ test_mqtt_audio_client.py # éŸ³è¨Šå®¢æˆ¶ç«¯æ¸¬è©¦
â”‚   â””â”€â”€ test_mqtt_servers.py     # æœå‹™å™¨æ¸¬è©¦
â”œâ”€â”€ platformio.ini               # PlatformIO é…ç½®
â””â”€â”€ README.md                    # æœ¬èªªæ˜æ–‡ä»¶
```

## ğŸ“ ä¾è³´å¥—ä»¶

å·²åœ¨ `platformio.ini` ä¸­é…ç½®ï¼š

```ini
lib_deps = 
    adafruit/Adafruit NeoPixel@^1.11.0
    thingpulse/ESP8266 and ESP32 OLED driver for SSD1306 displays@^4.4.0
    bblanchon/ArduinoJson@^7.0.0
    knolleary/PubSubClient@^2.8
```

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ç·¨è­¯éŒ¯èª¤ "No such file or directory"

**A**: ç¢ºä¿å·²å®‰è£æ‰€æœ‰ä¾è³´å¥—ä»¶ï¼š`pio lib install`

### Q2: WiFi é€£æ¥å¤±æ•—

**A**: æª¢æŸ¥ WiFi æ†‘è­‰å’Œä¿¡è™Ÿå¼·åº¦ï¼Œç¢ºä¿ä½¿ç”¨ 2.4GHz ç¶²è·¯ã€‚

### Q3: MQTT é€£æ¥å¤±æ•—

**A**: æª¢æŸ¥ç¶²è·¯é€£æ¥ï¼Œå˜—è©¦å…¶ä»– MQTT æœå‹™å™¨ï¼Œæª¢æŸ¥é˜²ç«ç‰†è¨­å®šã€‚

### Q4: éº¥å…‹é¢¨ç„¡è²éŸ³

**A**: æª¢æŸ¥æ¥ç·šæ˜¯å¦æ­£ç¢ºï¼Œç¢ºèªéº¥å…‹é¢¨é›»æºä¾›æ‡‰ï¼Œæª¢æŸ¥ GPIO å¼•è…³é…ç½®ã€‚

### Q5: OLED ä¸é¡¯ç¤º

**A**: æª¢æŸ¥ I2C æ¥ç·šï¼Œç¢ºèª OLED æ¨¡çµ„é¡å‹ï¼Œæª¢æŸ¥é›»æºä¾›æ‡‰ã€‚

## ğŸ”§ è©³ç´°æ•…éšœæ’é™¤

### ç·¨è­¯å’Œä¸Šå‚³å•é¡Œ

#### ç·¨è­¯éŒ¯èª¤

**å•é¡Œ**ï¼šLibrary not found æˆ–ä¾è³´åº«éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# å®‰è£ä¾è³´åº«
platformio lib install

# æ¸…ç†ä¸¦é‡æ–°ç·¨è­¯
platformio run --target clean
platformio run
```

#### ä¸Šå‚³å¤±æ•—

**å•é¡Œ**ï¼šç„¡æ³•æ‰¾åˆ° COM ç«¯å£æˆ–ä¸Šå‚³è¶…æ™‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

- æª¢æŸ¥ USB ç·šæ˜¯å¦æ”¯æ´æ•¸æ“šå‚³è¼¸
- ç¢ºèªé–‹ç™¼æ¿é©…å‹•ç¨‹å¼å·²å®‰è£
- å˜—è©¦ä¸åŒçš„ COM ç«¯å£
- åœ¨ä¸Šå‚³æ™‚æŒ‰ä½ Boot æŒ‰éˆ•

### ç¡¬é«”å•é¡Œ

#### æŒ‰éˆ•ç„¡éŸ¿æ‡‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

- æª¢æŸ¥æŒ‰éˆ•æ¥ç·šæ˜¯å¦æ­£ç¢º
- ç¢ºèª GPIO å¼•è…³é…ç½®
- æ¸¬è©¦æŒ‰éˆ•ç¡¬é«”æ˜¯å¦æ­£å¸¸
- èª¿æ•´é˜²æŠ–å‹•æ™‚é–“è¨­å®š

#### éŸ³è¨Šå•é¡Œ

**å•é¡Œ**ï¼šéº¥å…‹é¢¨ç„¡è²éŸ³æˆ–æ•¸æ“šå…¨é›¶

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

- ç¢ºèªéº¥å…‹é¢¨æ¥ç·šæ­£ç¢º
- æª¢æŸ¥ I2S å¼•è…³é…ç½®
- æ¸¬è©¦éº¥å…‹é¢¨é›»æºä¾›æ‡‰
- æŸ¥çœ‹ä¸²å£è¼¸å‡ºçš„éŸ³è¨Šé›»å¹³è³‡è¨Š

#### ç³»çµ±é‡å•Ÿå•é¡Œ

**å•é¡Œ**ï¼šGuru Meditation Error æˆ–é »ç¹é‡å•Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

- æª¢æŸ¥é›»æºä¾›æ‡‰æ˜¯å¦ç©©å®š
- ç¢ºèªæ²’æœ‰å¼•è…³è¡çª
- é‡æ–°ç‡’éŒ„å®Œæ•´éŸŒé«”
- æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒå®šä½å•é¡ŒåŸå› 

### é™¤éŒ¯å·¥å…·

#### ä¸²å£é™¤éŒ¯

```bash
# Windows
platformio device monitor --port COM7 --baud 115200

# Linux/Mac
platformio device monitor --port /dev/ttyUSB0 --baud 115200
```

#### MQTT é™¤éŒ¯

```bash
# è¨‚é–±æ‰€æœ‰ä¸»é¡Œ
mosquitto_sub -h test.mosquitto.org -t "esp32/audio/#" -v

# ç™¼é€æ¸¬è©¦å‘½ä»¤
mosquitto_pub -h test.mosquitto.org -t "esp32/audio/control" \
  -m '{"command":"startPublishing","timestamp":1234567890}'
```

## ğŸ“– æŠ€è¡“åƒè€ƒ

### æ ¸å¿ƒ API

```cpp
// éŒ„éŸ³æ§åˆ¶
void startButtonRecording();
void stopButtonRecordingAndProcess();
void processRecordedAudio();

// I2S ç®¡ç†
bool setupMicrophone();
void safeCleanupI2SResources();

// ç‹€æ…‹ç®¡ç†
void updateSystemStatus();
void updateOLEDDisplay();
void updateLEDStatus();

// ç¶²è·¯é€šè¨Š
bool connectToWiFi();
bool connectToMQTT();
void publishAudioData(const int16_t* data, size_t length);
```

### æ•ˆèƒ½æŒ‡æ¨™

| é …ç›® | æ•¸å€¼ | èªªæ˜ |
|------|------|------|
| éŸ³è¨Šæ¡æ¨£ç‡ | 16 kHz | èªéŸ³æ‡‰ç”¨æ¨™æº–æ¡æ¨£ç‡ |
| éŸ³è¨Šä½æ·±åº¦ | 16-bit | CD å“è³ªä½æ·±åº¦ |
| è™•ç†å»¶é² | < 100 ms | å¾éŒ„éŸ³åˆ° MQTT ç™¼å¸ƒ |
| è¨˜æ†¶é«”ä½¿ç”¨ | ~46 KB RAM | é‹è¡Œæ™‚è¨˜æ†¶é«”ä½”ç”¨ |
| Flash ä½¿ç”¨ | ~880 KB | ç¨‹å¼ç¢¼å’Œåº«æª”æ¡ˆå¤§å° |
| WiFi é€£æ¥æ™‚é–“ | < 10 s | é¦–æ¬¡é€£æ¥åˆ°å¯ç”¨ç¶²è·¯ |
| I2S å•Ÿå‹•æ™‚é–“ | < 200 ms | I2S åˆå§‹åŒ–å®Œæˆæ™‚é–“ |
| åŠŸè€— | ~80 mA | æ­£å¸¸é‹è¡Œæ™‚å¹³å‡åŠŸè€— |

### ç³»çµ±é™åˆ¶

- **æœ€å¤§éŒ„éŸ³æ™‚é•·**ï¼šå—å¯ç”¨ RAM é™åˆ¶ï¼Œç´„ 30-60 ç§’
- **åŒæ™‚ I2S ç«¯å£**ï¼š1 å€‹ (I2S_NUM_1)
- **æ”¯æ´éŸ³è¨Šæ ¼å¼**ï¼šPCM 16-bit å–®è²é“
- **ç¶²è·¯å”è­°**ï¼šWiFi 2.4GHzï¼Œä¸æ”¯æ´ 5GHz
- **MQTT å°åŒ…å¤§å°**ï¼šæœ€å¤§ 256 æ¨£æœ¬/å°åŒ…

## ğŸ“š ç‰ˆæœ¬æ­·å²

### v1.0.0 (ç•¶å‰ç‰ˆæœ¬) - 2025-07-02

**æ–°åŠŸèƒ½ï¼š**

- âœ… å®Œæ•´çš„æŒ‰éˆ•æ§åˆ¶éŒ„éŸ³åŠŸèƒ½
- âœ… å®‰å…¨çš„ I2S è³‡æºç®¡ç†
- âœ… OLED/LED ç‹€æ…‹æŒ‡ç¤ºç³»çµ±
- âœ… WiFi è‡ªå‹•é€£æ¥å’Œé‡é€£
- âœ… ç¡¬é«”è‡ªé©æ‡‰å’Œé™ç´šæ©Ÿåˆ¶

**ä¿®å¾©å•é¡Œï¼š**

- ğŸ› è§£æ±ºæŒ‰éˆ•è§¸ç™¼ç³»çµ±é‡å•Ÿå•é¡Œ
- ğŸ› ä¿®å¾© I2S è³‡æºæ¸…ç†æ™‚çš„å´©æ½°å•é¡Œ
- ğŸ› è§£æ±º OLED ç¡¬é«”ç¼ºå¤±æ™‚çš„ç³»çµ±ç•°å¸¸

**å·²çŸ¥å•é¡Œï¼š**

- âš ï¸ MQTT åŠŸèƒ½æš«æ™‚åœç”¨ (ç‚ºå°ˆæ³¨åŸºæœ¬åŠŸèƒ½ç©©å®šæ€§)
- âš ï¸ éŸ³è¨Šæ’­æ”¾åŠŸèƒ½éœ€è¦é€²ä¸€æ­¥æ¸¬è©¦

### v0.9.0 - 2024-12

**ä¸»è¦è®Šæ›´ï¼š**

- å¾è‡ªå‹•éŒ„éŸ³æ¨¡å¼æ”¹ç‚ºæŒ‰éˆ•æ§åˆ¶æ¨¡å¼
- é‡æ§‹æŒ‰éˆ•è™•ç†å’Œç‹€æ…‹ç®¡ç†
- æ–°å¢ OLED é¡¯ç¤ºæ”¯æ´

### v0.8.0 - 2024-11

**åˆå§‹ç‰ˆæœ¬ï¼š**

- åŸºæœ¬ I2S éŸ³è¨ŠéŒ„è£½åŠŸèƒ½
- MQTT éŸ³è¨Šå‚³è¼¸
- LED ç‹€æ…‹æŒ‡ç¤º

## ğŸš€ æœªä¾†è¦åŠƒ

### è¨ˆåŠƒåŠŸèƒ½

- **ğŸ”„ MQTT éŸ³è¨Šå‚³è¼¸**ï¼šé‡æ–°å•Ÿç”¨ä¸¦å„ªåŒ– MQTT åŠŸèƒ½
- **ğŸŒ Web ç®¡ç†ä»‹é¢**ï¼šé€éç€è¦½å™¨ç®¡ç†ç³»çµ±è¨­å®š
- **ğŸ“± è¡Œå‹•æ‡‰ç”¨**ï¼šAndroid/iOS é ç«¯æ§åˆ¶æ‡‰ç”¨
- **ğŸ”Š éŸ³è¨Šæ’­æ”¾**ï¼šæ”¯æ´å¤šæ ¼å¼éŸ³è¨Šæª”æ¡ˆæ’­æ”¾
- **â˜ï¸ é›²ç«¯æ•´åˆ**ï¼šæ”¯æ´ AWS IoTã€Azure IoT ç­‰é›²ç«¯æœå‹™

### æŠ€è¡“å„ªåŒ–

- **ä½åŠŸè€—æ¨¡å¼**ï¼šæ”¯æ´æ·±åº¦ç¡çœ å’Œå–šé†’æ©Ÿåˆ¶
- **OTA æ›´æ–°**ï¼šç„¡ç·šéŸŒé«”æ›´æ–°åŠŸèƒ½
- **å®‰å…¨åŠ å¯†**ï¼šMQTT å’Œ WiFi é€šè¨ŠåŠ å¯†
- **å¤šèªè¨€æ”¯æ´**ï¼šåœ‹éš›åŒ–ä»‹é¢å’ŒèªéŸ³æç¤º

---

**å°ˆæ¡ˆç‰ˆæœ¬**: v1.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-07-02  
**ç›¸å®¹æ€§**: ESP32-S3, PlatformIO, Arduino Framework  
**æˆæ¬Š**: MIT License  
**ç¶­è­·è€…**: ProjectG é–‹ç™¼åœ˜éšŠ
